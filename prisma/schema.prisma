generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  VENDOR
  SUBSCRIBER
  ADMIN
  CEO
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  PAID
}

model User {
  id               String    @id @default(cuid())
  firebaseUid      String    @unique
  email            String    @unique
  name             String?
  role             Role      @default(USER)
  subscriptionTier String    @default("NONE")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  // Relations
  orders           Order[]
  vendorProfile    Vendor?
  agents           Agent[]
  subscriptions    Subscription[]
}

model Vendor {
  id             String    @id @default(cuid())
  userId         String    @unique
  user           User      @relation(fields: [userId], references: [id])
  name           String
  description    String?
  commissionRate Float     @default(0.10)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  // Relations
  products       Product[]
}

model Product {
  id           String    @id @default(cuid())
  title        String
  description  String
  price        Float
  images       String[]
  category     String
  stock        Int       @default(0)
  rating       Float     @default(0)
  affiliateUrl String?
  vendorId     String
  vendor       Vendor    @relation(fields: [vendorId], references: [id])
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  orderItems   OrderItem[]
}

model Order {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  total       Float
  status      OrderStatus @default(PENDING)
  paymentId   String?     // Stripe/Paystack reference
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  items       OrderItem[]
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float   // Price at time of purchase
}

model Agent {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String   // e.g., 'SCRAPER', 'TRADER', 'ANALYST'
  state     String   @default("IDLE") // e.g., 'IDLE', 'RUNNING', 'ERROR'
  config    Json?    // Configuration for the agent
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Subscription {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  plan      String   // e.g., 'FREE', 'PRO', 'ENTERPRISE'
  status    String   @default("ACTIVE")
  expiresAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Lead {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  name      String
  email     String?
  contact   String?
  value     Float?
  status    String   @default("NEW") // e.g., 'NEW', 'CONTACTED', 'CLOSED'
  origin    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
