// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  VENDOR
  ADMIN
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model User {
  id               String    @id @default(cuid())
  firebaseUid      String    @unique
  email            String    @unique
  name             String?
  role             Role      @default(USER)
  subscriptionTier String    @default("NONE")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  // Relations
  orders           Order[]
  vendorProfile    Vendor?
}

model Vendor {
  id             String    @id @default(cuid())
  userId         String    @unique
  user           User      @relation(fields: [userId], references: [id])
  name           String
  description    String?
  commissionRate Float     @default(0.10)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  // Relations
  products       Product[]
}

model Product {
  id           String    @id @default(cuid())
  title        String
  description  String
  price        Float
  images       String[]
  category     String
  stock        Int       @default(0)
  rating       Float     @default(0)
  affiliateUrl String?
  vendorId     String
  vendor       Vendor    @relation(fields: [vendorId], references: [id])
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  orderItems   OrderItem[]
}

model Order {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  total       Float
  status      OrderStatus @default(PENDING)
  paymentId   String?     // Stripe/Paystack reference
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  items       OrderItem[]
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float   // Price at time of purchase
}
